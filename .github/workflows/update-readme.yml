# è¿™ä¸ª GitHub Action çš„åå­—æ˜¯ "Update the main branch README profile page with a script"
name: Update the main branch README profile page with a script

# è§¦å‘æ¡ä»¶ï¼š
on:
  # å½“æœ‰æ–°çš„ push æ“ä½œæ—¶è§¦å‘
  push:
  # æˆ‘åœ¨ä½¿ç”¨ GitHub CLI ï¼ˆghï¼‰ å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
  # gh workflow run update-readme
  workflow_dispatch:
  # å½“æœ‰æ–°çš„ pull request æ“ä½œæ—¶è§¦å‘
  pull_request:
  schedule: 
    # Runs on the 8, 10, 14 and 16th hour.
    - cron: "0 8-11/5,14-17/4 * * *"
    # Runs at 00:00 UTC every day.
    - cron: "0 0 * * *"
    - cron: "0 */8 * * *"

# åœ¨è§¦å‘åï¼Œä¼šè¿è¡Œä¸€ä¸ªåä¸º "markscribe" çš„ jobï¼Œè¯¥ job åœ¨ Ubuntu ç³»ç»Ÿæœ€æ–°ç‰ˆä¸Šè¿è¡Œã€‚
jobs:
  markscribe:
    runs-on: ubuntu-latest

    # è¿™ä¸ª job æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š
    steps:
      # ä½¿ç”¨ actions/checkout@main æ“ä½œï¼Œå°†é¡¹ç›®ä»£ç åº“å…‹éš†åˆ°å·¥ä½œåŒºã€‚
      - uses: actions/checkout@main

      # ä½¿ç”¨ muesli/readme-scribe@master æ“ä½œï¼Œä½¿ç”¨æŒ‡å®šçš„æ¨¡æ¿ç”Ÿæˆ README æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ã€‚
      - uses: muesli/readme-scribe@master
        # ä½¿ç”¨è€…æä¾›çš„ä»¤ç‰Œï¼Œå¯ä»¥è®© Action è®¿é—®ä½¿ç”¨è€…åœ¨ GitHub ä¸Šçš„ç§æœ‰æ•°æ®ã€‚
        env:
          GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}
        with:
          template: "templates/README.md.tpl"
          writeTo: "README.md"
      # ä½¿ç”¨ stefanzweifel/git-auto-commit-action@v4 æ“ä½œï¼Œå°†ç”Ÿæˆçš„ README æ–‡ä»¶æäº¤åˆ°é¡¹ç›®çš„ "main" åˆ†æ”¯ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„ç”¨æˆ·åå’Œé‚®ç®±è®°å½•æäº¤è®°å½•ã€‚
      - uses: stefanzweifel/git-auto-commit-action@v4
        # ä½¿ç”¨è€…æä¾›çš„ä»¤ç‰Œï¼Œå¯ä»¥è®© Action è®¿é—®ä½¿ç”¨è€…åœ¨ GitHub ä¸Šçš„ç§æœ‰æ•°æ®ã€‚
        env:
          GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}
        with:
          commit_message: Update generated README
          branch: main
          commit_user_name: kubbot ğŸ¤–
          commit_user_email: 3293172751ysy@gmail.com
          commit_author: kubbot ğŸ¤– <3293172751ysy@gmail.com>
          
      # è¿è¡Œä¸€ç³»åˆ— shell å‘½ä»¤ï¼Œé…ç½®æœ¬åœ° Git è®¾ç½®ï¼Œä»è¿œç¨‹åº“æ‹‰å–æœ€æ–°ç‰ˆæœ¬å¹¶æ¨é€åˆ°è¿œç¨‹åº“ã€‚
      - name: Auto green
        run: |
          git config --local user.email "3293172751ysy@gmail.com"
          git config --local user.name "kubbot"
          git remote set-url origin https://${{ secrets.BOT_GITHUB_TOKEN }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
          git pull --rebase
          # å°† UTC æ—¶é—´è½¬æ¢ä¸ºä¸Šæµ·æ—¶é—´
          local_time=$(date -u -d "$(date -u)" "+%Y-%m-%d %H:%M:%S" -d "8 hours")
          echo " ğŸš€ Shanghai time of last status update by the bot <a href='https://github.com/kubbot'>@kubbot</a>: $local_time" >> README.md
          # å…è®¸ç©ºæäº¤ï¼Œ-a çœç•¥git add . è€Œä¸”è®¾ç½®ç­¾å
          git commit --allow-empty -a -s -m "ğŸŒŸ You never lose, either you win or you learn! ğŸ’ª"
          git push
# env
# GITHUB_TOKENï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ä»¤ç‰Œï¼Œå¯ä»¥è®© Action è®¿é—®é¡¹ç›®çš„æ•°æ®ã€‚
# PERSONAL_GITHUB_TOKENï¼šè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨è€…æä¾›çš„ä»¤ç‰Œï¼Œå¯ä»¥è®© Action è®¿é—®ä½¿ç”¨è€…åœ¨ GitHub ä¸Šçš„ç§æœ‰æ•°æ®ã€‚
